FROM node:20-slim
WORKDIR /app

# Enable corepack for Yarn Berry
RUN corepack enable

# Install dependencies (context is ./web)
COPY .yarn/ ./.yarn/
COPY .yarnrc.yml package.json yarn.lock ./
RUN yarn install --immutable
RUN npx playwright install --with-deps chromium

# Copy the rest of the app
COPY . ./

# Development environment setup
ENV NODE_ENV=development
ENV PORT=5173
ENV HOST=0.0.0.0

# Expose development port
EXPOSE 5173

CMD ["yarn", "dev"]
